# 2026-02-08 고스톱 앱 QA 테스트 - Issue #3 연속 게임 버그 해결

## 진행 상황

### Issue #3: 연속 게임 시작 버튼 사라짐
- **문제**: 첫 게임 완료 후 홈 복귀 시 "Start Game" 버튼 비활성화, 2번째 게임 시작 불가
- **근본 원인**: Integration test 환경에서 lifecycle timing mismatch
  - 테스트가 버튼 찾기 시도 < GameScreen deactivate 호출 시점
  - Provider 리셋 타이밍 문제

### 시도 이력 (v7 ~ v8.5)
- **v7**: `context.pop()` 대신 `/game/play` 직접 이동 → 5 pass / 1 fail (실패)
- **v8**: Provider 기반 상태 관리 추가 → 2 pass / 4 fail (더 나빠짐)
- **v8.1**: deactivate 사용 → 5 pass / 1 fail (동일)
- **v8.2**: 게임 요약 콜백에 Provider 리셋 → 게임 요약 미표시
- **v8.3**: 7턴 후 강제 나가기 추가 → 부분 성공 (게임 #2 시작하나 버튼 없음)
- **v8.4**: pumpAndSettle로 lifecycle 동기화 + 10초 cleanup timeout → **실패** (gameMoneyRepositoryProvider override 누락)
- **v8.5**: Provider override 추가 (테스트 실행 중)

### v8.4 실패 원인 분석
```
에러: gameMoneyRepositoryProvider must be overridden
원인: Integration test의 ProviderScope에 overrides 없음
- gameMoneyRepositoryProvider
- userProgressRepositoryProvider
이 두 Provider는 main.dart에서만 override되어 있었음
```

### v8.5 수정사항
**Integration test에 Fake Repository 클래스 추가:**
```dart
// FakeGameMoneyRepository, FakeUserProgressRepository 구현
// in-memory 저장소 사용

// ProviderScope에 override 추가
ProviderScope(
  overrides: [
    gameMoneyRepositoryProvider.overrideWithValue(FakeGameMoneyRepository()),
    userProgressRepositoryProvider.overrideWithValue(FakeUserProgressRepository()),
  ],
  child: ...,
)
```

### 현재 상태
- **v8.5 테스트 실행 중** (session: young-atlas, pid 41984)
- **예상 시간**: 4-5분
- **자동 결과 확인**: 4분 후

## 기대 효과
- Provider override 누락 에러 해결
- 모든 6개 테스트 통과 가능성

## 다음 단계
1. v8.5 결과 확인
2. 성공 시: 모든 issue 완료 → 수동 QA 진행
3. 실패 시: 대안 전략 선택
   - Option A: 각 게임마다 테스트 분리 (독립적 실행)
   - Option B: Integration test는 1게임만, 연속 게임은 수동 QA
   - Option C: 근본 원인 분석 계속
