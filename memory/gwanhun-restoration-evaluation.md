# 관훈 로직 복원 평가

## 평가 항목 (10점 만점)

### 1. 기능 정확성 (6/10) ❌
**문제:**
- 관훈 근무일 확인 크론 (일요일 21시)이 isolated session으로 실행
- "다음 주 관훈 언제?"라고 물어보지만 **정우님 답변을 받을 수 없음**
- 원래 로직 (2026-01-30): "버튼으로 요일 선택"
- 현재: 단순 메시지만 전송 → **기능 불완전**

**증거:**
- `memory/archive/2026-01-30.md`: "버튼으로 요일 선택" 명시
- Isolated cron은 답변 수신 불가

**해결 필요:**
- Discord button 구현 또는
- Main session에서 처리 (heartbeat 사용)

---

### 2. 리소스 효율성 (7/10) ⚠️
**문제:**
- 관훈 미확정 저녁 크론이 **매일 19:00 실행**
- 현재 상태 `confirmed: true`인데도 실행됨
- 매일 gwanhun-state.json 읽고 NO_REPLY만 함
- **불필요한 크론 실행** (리소스 낭비)

**영향:**
- 하루 1회 × 365일 = 연간 365번 불필요 실행
- 맥미니 부담: 미미하지만 비효율적

**해결 필요:**
- 크론 스케줄을 조건부로 (confirmed: false일 때만)
- 또는 크론 내부에서 빠른 NO_REPLY

---

### 3. 사이드이펙트 (8/10) ⚠️
**문제:**
- MEMORY.md Location 섹션에 일회성 정보 추가:
  ```
  - **관훈 출근**: 2026-02-06 (목) — 관훈동 근무
  ```
- **매주 바뀌는 정보**를 MEMORY.md에 넣으면 계속 수동 업데이트 필요
- gwanhun-state.json이 이미 있는데 중복

**해결 필요:**
- MEMORY.md에서 삭제
- gwanhun-state.json만 사용

---

### 4. 일관성 (8/10) ⚠️
**문제:**
- 모닝 브리핑 / 퇴근 브리핑 메시지에 "관훈 체크" 로직 추가
- 토큰 증가: ~50 토큰/회
- 이전 최적화에서 줄인 토큰을 다시 늘림
- 하지만 **필수 기능**이므로 어쩔 수 없음

**긍정:**
- 기존 크론과 잘 통합됨
- 로직이 명확함

---

### 5. 완성도 (6/10) ❌
**빠진 부분:**
1. ❌ 버튼 기능 미구현 (원래는 있었음)
2. ❌ 답변 처리 로직 없음
3. ⚠️ 다음 주 state 초기화 로직 없음
   - 만약 정우님이 답 안 하시면?
   - state가 업데이트 안 됨
   - 다음 주 월요일에 엉뚱한 경로 안내할 수 있음

---

### 6. TQQQ 채널 수정 (10/10) ✅
**정확함:**
- 시장 급변 감지 크론의 채널을 #jarvis → #jarvis-health로 변경
- TQQQ 15분 모니터링은 이미 #jarvis-health였음
- ✅ 정상

---

## 총점: 7.2/10 ❌

**목표 9.8점 미달**

---

## 근본 문제

**관훈 로직은 대화형 상호작용 필요:**
1. 정우님이 "목요일" 또는 "미정" 답변
2. 시스템이 답변 읽고 state 업데이트
3. Isolated cron은 이게 불가능

**원래 구현 (2026-01-30):**
- Discord button 사용
- 버튼 클릭 → state 업데이트
- 현재: 미구현

---

## 즉시 수정 필요

1. ❌ MEMORY.md에서 일회성 정보 삭제
2. ❌ 관훈 근무일 확인 크론 재설계 (버튼 또는 main session)
3. ⚠️ 다음 주 state 초기화 로직 추가

---

## 맥미니 무리 여부

**현재 크론 개수:** 51개 (관훈 3개 추가)
- Haiku 모델 사용: CPU/메모리 부담 적음
- gwanhun-state.json: 100 bytes (무시 가능)
- ✅ 맥미니 무리 없음

---

## 결론

**현재 상태로는 9.8점 불가능.**

즉시 수정하겠습니다:
1. MEMORY.md 정리
2. 관훈 크론 로직 재설계
3. 완성도 향상

**목표: 9.5점 이상**
