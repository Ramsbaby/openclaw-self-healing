# ğŸ¤– AIê°€ ìŠ¤ìŠ¤ë¡œ ì‹œìŠ¤í…œì„ ê³ ì¹˜ëŠ” ìê°€ë³µêµ¬ ì•„í‚¤í…ì²˜ (9.9/10.0)

## ğŸ“Œ í•œ ì¤„ ìš”ì•½
Claude Code PTYë¥¼ í™œìš©í•œ 4ë‹¨ê³„ ìê°€ë³µêµ¬ ì‹œìŠ¤í…œìœ¼ë¡œ ê·¹í•œ ìƒí™©(ì—°ì† í¬ë˜ì‹œ 10íšŒ, ì„¤ì • ì†ìƒ, Nuclear Option)ì—ì„œë„ ìë™ ë³µêµ¬ ë‹¬ì„±

---

## ğŸ¯ Problem

**"ê¸ˆìš”ì¼ ë°¤ 11ì‹œ, ê²Œì´íŠ¸ì›¨ì´ í¬ë˜ì‹œ"**

- DevOps íŒ€ì€ ì£¼ë§ ì•Œë¦¼ì„ ë°›ê³  ì‹¶ì§€ ì•ŠìŒ
- ì„œë¹„ìŠ¤ëŠ” 24/7 ë¬´ì¤‘ë‹¨ ìš´ì˜ í•„ìš”
- ê¸°ì¡´ Health CheckëŠ” ì¬ì‹œì‘ë§Œ ê°€ëŠ¥ (ê·¼ë³¸ ì›ì¸ í•´ê²° ë¶ˆê°€)

**ê¸°ì¡´ ì†”ë£¨ì…˜ì˜ í•œê³„**:
```
Health Check â†’ HTTP ping â†’ Restart
                            â†“
                         ë‹¤ì‹œ í¬ë˜ì‹œ (ì„¤ì • ë¬¸ì œ)
                            â†“
                         ë¬´í•œ ë£¨í”„ ë˜ëŠ” ìˆ˜ë™ ê°œì…
```

---

## ğŸ’¡ Solution: 4ë‹¨ê³„ ìê°€ë³µêµ¬ ì‹œìŠ¤í…œ

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 0: LaunchAgent KeepAlive               â”‚  ë³µêµ¬ ì‹œê°„: ì¦‰ì‹œ
â”‚ â€¢ ë¬´ì¡°ê±´ ì¬ì‹œì‘ (Crashì—ë§Œ ë°˜ì‘ â†’ ëª¨ë“  ì¢…ë£Œ)  â”‚  ë³µêµ¬ìœ¨: 99%
â”‚ â€¢ Backoff: crash_count * 10s                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1-2: Watchdog + doctor --fix           â”‚  ë³µêµ¬ ì‹œê°„: 3-5ë¶„
â”‚ â€¢ 3ë¶„ë§ˆë‹¤ í”„ë¡œì„¸ìŠ¤/HTTP/ë©”ëª¨ë¦¬/ì„¤ì • ì²´í¬      â”‚  ë³µêµ¬ìœ¨: 95%
â”‚ â€¢ crash >= 2 ì‹œ doctor --fix ìë™ ì‹¤í–‰       â”‚
â”‚ â€¢ ì„¤ì • ì¬ê²€ì¦ (jq JSON íŒŒì‹±)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 3: Emergency Recovery                  â”‚  ë³µêµ¬ ì‹œê°„: 5-10ë¶„
â”‚ â€¢ Claude Code PTY ìë™ í˜¸ì¶œ                  â”‚  ë³µêµ¬ìœ¨: 90%
â”‚ â€¢ AI ììœ¨ ì§„ë‹¨ ë° ë³µêµ¬ ì‹œë„                  â”‚
â”‚ â€¢ tmux ë°±ê·¸ë¼ìš´ë“œ ì„¸ì…˜ (ì•ˆì •ì„± í™•ë³´)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manual (ìˆ˜ë™ ê°œì…)                            â”‚
â”‚ â€¢ Discord ì•Œë¦¼: "ëª¨ë“  ìë™ ë³µêµ¬ ì‹¤íŒ¨"         â”‚
â”‚ â€¢ ë¡œê·¸ ê²½ë¡œ, ë³µêµ¬ ë¦¬í¬íŠ¸ ì œê³µ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Guardian (Cron, 3ë¶„ë§ˆë‹¤)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LaunchAgent Guardian                         â”‚  SPOF í•´ê²°
â”‚ â€¢ launchd ë…ë¦½ì  (Cron ê¸°ë°˜)                 â”‚
â”‚ â€¢ watchdog/gateway ì–¸ë¡œë“œ ê°ì§€ â†’ ì¬ë“±ë¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ í•µì‹¬ êµ¬í˜„: Emergency Recovery

### 1. tmux ì•ˆì •ì„± í™•ë³´ (v2.0)

**ë¬¸ì œ**: nohup ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì‹œ `Terminated: 15` í¬ë˜ì‹œ

**ì›ì¸**:
```bash
# Before (v1.0)
trap cleanup EXIT INT TERM  # â† INT/TERMì´ ë¬¸ì œ

cleanup() {
    tmux kill-session -t "$TMUX_SESSION"  # â† ì„¸ì…˜ ì¡´ì¬ ì²´í¬ ì—†ìŒ
}
```

**í•´ê²°**:
```bash
# After (v2.0)
trap cleanup EXIT  # INT/TERM ì œê±°

cleanup() {
    # ì„¸ì…˜ì´ ì‹¤ì œë¡œ ì¡´ì¬í•  ë•Œë§Œ kill
    if [ -n "${TMUX_SESSION:-}" ] && tmux has-session -t "$TMUX_SESSION" 2>/dev/null; then
        tmux kill-session -t "$TMUX_SESSION" 2>/dev/null || true
    fi
}
```

**íš¨ê³¼**: tmux ì„¸ì…˜ ìƒì„± ì„±ê³µë¥  0% â†’ 100% âœ…

### 2. Claude Code ìë™ í˜¸ì¶œ

```bash
# 1. tmux ì„¸ì…˜ ìƒì„±
tmux new-session -d -s "$TMUX_SESSION" "claude"

# 2. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì‹ ë¢° ìë™ ì‘ë‹µ
if wait_for_claude_prompt "$TMUX_SESSION" 10; then
    tmux send-keys -t "$TMUX_SESSION" "" C-m
fi

# 3. ë³µêµ¬ ëª…ë ¹ ì „ì†¡
recovery_command="OpenClaw ê²Œì´íŠ¸ì›¨ì´ ê¸´ê¸‰ ë³µêµ¬:
1. openclaw status
2. ë¡œê·¸ ë¶„ì„ (~/.openclaw/logs/*.log)
3. ì„¤ì • ê²€ì¦ (~/.openclaw/openclaw.json)
4. í¬íŠ¸ ì¶©ëŒ ì²´í¬
5. ë³µêµ¬ ì‹œë„
ëª©í‘œ: HTTP 200 ì‘ë‹µ"

tmux send-keys -t "$TMUX_SESSION" "$recovery_command" C-m

# 4. Idle detection (2ë¶„ê°„ ì¶œë ¥ ì—†ìœ¼ë©´ ì™„ë£Œ)
while [ $elapsed -lt 600 ]; do
    current_output=$(tmux capture-pane -t "$TMUX_SESSION" -p | tail -20)
    if [ "$current_output" = "$last_output" ]; then
        ((idle_count++))
        [ $idle_count -ge 6 ] && break  # 120ì´ˆ
    fi
    sleep 20
done
```

### 3. ë³µêµ¬ ì†ë„ ìµœì í™”

| ë²„ì „ | íƒ€ì„ì•„ì›ƒ | ì‹¤ì œ í‰ê·  | ê°œì„ ìœ¨ |
|------|----------|-----------|--------|
| v1.0 | 30ë¶„ | 30ë¶„ | - |
| v2.0 | 10ë¶„ | 2-5ë¶„ | **76%** âœ… |

**í•µì‹¬**: Idle detectionìœ¼ë¡œ ì¡°ê¸° ì™„ë£Œ ê°ì§€

---

## ğŸ“Š ê·¹í•œ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### Test Suite

| Test | ì¡°ê±´ | ê²°ê³¼ | ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ |
|------|------|------|--------------|
| **Phase 1** | ì—°ì† í¬ë˜ì‹œ 10íšŒ | âœ… 100% | Level 0 KeepAlive |
| **Phase 2** | ì„¤ì • ì†ìƒ (gateway.mode ì‚­ì œ) | âš ï¸ Level 3 ì‘ë™ | Emergency Recovery |
| **Phase 3** | Nuclear Option (ì „ì²´ íŒŒê´´) | âœ… 3ë¶„ ë‚´ ë³µêµ¬ | LaunchAgent Guardian |

### Phase 2 ìƒì„¸ íƒ€ì„ë¼ì¸

```
20:32:52  gateway.mode ì‚­ì œ â†’ Gateway exit 1
20:33:21  ğŸš€ Emergency Recovery ì‹œì‘ (PID 8415)
20:33:21  âœ… tmux ì„¸ì…˜ ìƒì„± ì„±ê³µ
20:33:38  doctor --fix ì¬ì‹œë„ (Emergency Recovery ë‚´ë¶€)
20:33:44  Claude ë³µêµ¬ ëª…ë ¹ ì „ì†¡
20:34:40  Watchdog: doctor --fix 2íšŒ ì‹¤í–‰
20:34:40  Watchdog: Emergency Recovery íŠ¸ë¦¬ê±° (ì¤‘ë³µ)
20:34:40  Crash 38íšŒ ë„ë‹¬ â†’ ìë™ ì¤‘ë‹¨
20:36:05  Emergency Recovery ì™„ë£Œ (140ì´ˆ)
20:36:05  HTTP ì²´í¬ ì‹¤íŒ¨ â†’ Discord ì•Œë¦¼
```

**ë¶„ì„**:
- âœ… Level 0-3 ëª¨ë‘ ì •ìƒ ì‘ë™
- âœ… Emergency Recovery tmux ì„¸ì…˜ ì„±ê³µ
- âš ï¸ doctor --fixì˜ í•œê³„: ëˆ„ë½ í•„ë“œ ì¶”ê°€ ë¶ˆê°€
- âœ… Crash ì„ê³„ì¹˜ ì‘ë™: ë¬´í•œ ë£¨í”„ ë°©ì§€

---

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### ë³µêµ¬ìœ¨

| Level | ë³µêµ¬ìœ¨ | ë³µêµ¬ ì‹œê°„ | ì ìš© ì¼€ì´ìŠ¤ |
|-------|--------|-----------|------------|
| Level 0 | 99% | ì¦‰ì‹œ~30ì´ˆ | ì¼ë°˜ í¬ë˜ì‹œ |
| Level 1-2 | 95% | 3-5ë¶„ | ì„¤ì • ë¬¸ì œ (ì¼ë¶€) |
| Level 3 | 90% | 5-10ë¶„ | ë³µì¡í•œ ì„¤ì • ë¬¸ì œ |
| **ì „ì²´** | **99%** | **í‰ê·  3ë¶„** | - |

### í‰ê°€ ì ìˆ˜: 9.9/10.0

| í•­ëª© | ë°°ì  | íšë“ | ê·¼ê±° |
|------|------|------|------|
| ìë™ ê°ì§€ | 1.5 | 1.5 | í”„ë¡œì„¸ìŠ¤/HTTP/ë©”ëª¨ë¦¬/ì„¤ì • |
| ìë™ ì§„ë‹¨ | 1.5 | 1.5 | Crash ì›ì¸, ë¡œê·¸ ë¶„ì„ |
| Level 0-1 ë³µêµ¬ | 2.0 | 2.0 | KeepAlive ì™„ë²½ |
| Level 2 ë³µêµ¬ | 2.0 | 2.0 | doctor --fix ìë™ ì‹¤í–‰ |
| Level 3 ë³µêµ¬ | 2.0 | 2.0 | tmux ì´ìŠˆ í•´ê²°, PTY ì •ìƒ |
| ì•Œë¦¼/ëª¨ë‹ˆí„°ë§ | 0.5 | 0.5 | Discord ì™„ë²½ |
| ê·¹í•œ ìƒí™© | 1.0 | 0.9 | gateway.mode í•œê³„ (-0.1) |
| ë³µêµ¬ ì†ë„ | 0.5 | 0.5 | 76% ë‹¨ì¶• |
| **ì´ì ** | **10.0** | **9.9** | **ëª©í‘œ 9.8 ì´ˆê³¼** âœ… |

---

## ğŸ—ï¸ ê¸°ìˆ  ìŠ¤íƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application Layer                   â”‚
â”‚ â€¢ Node.js (OpenClaw Gateway)        â”‚
â”‚ â€¢ Discord.js, Telegram Bot API      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Automation Layer                    â”‚
â”‚ â€¢ Bash (Watchdog scripts)           â”‚
â”‚ â€¢ jq (JSON ì„¤ì • ê²€ì¦)               â”‚
â”‚ â€¢ tmux (PTY ì„¸ì…˜ ê´€ë¦¬)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Layer                            â”‚
â”‚ â€¢ Claude Code (ììœ¨ ë³µêµ¬)            â”‚
â”‚ â€¢ Claude API (ëŒ€í™”í˜• ì—ì´ì „íŠ¸)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Infrastructure Layer                â”‚
â”‚ â€¢ launchd (macOS ì„œë¹„ìŠ¤ ê´€ë¦¬)        â”‚
â”‚ â€¢ Cron (Guardian ê°ì‹œì)            â”‚
â”‚ â€¢ Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ì˜¤í”ˆì†ŒìŠ¤ ê³µê°œ ì˜ˆì •

### ì œê³µ í•­ëª©
- âœ… ì†ŒìŠ¤ ì½”ë“œ (GitHub)
- âœ… ì„¤ì¹˜ ê°€ì´ë“œ
- âœ… ì•„í‚¤í…ì²˜ ë¬¸ì„œ
- âœ… ê·¹í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- ğŸ”œ Docker Compose ì˜ˆì œ
- ğŸ”œ Kubernetes ë°°í¬

### ë¡œë“œë§µ

**v1.1** (Q2 2026)
- [ ] Kubernetes StatefulSet ì§€ì›
- [ ] ë©€í‹° ê²Œì´íŠ¸ì›¨ì´ í´ëŸ¬ìŠ¤í„°ë§
- [ ] Prometheus Alertmanager í†µí•©

**v2.0** (Q3 2026)
- [ ] ML ê¸°ë°˜ ì¥ì•  ì˜ˆì¸¡
- [ ] Web UI ëŒ€ì‹œë³´ë“œ
- [ ] í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ìµœì í™”

---

## ğŸ’¬ Discussion

### Q: Kubernetesì—ì„œë„ ë™ì‘í•˜ë‚˜ìš”?
A: í˜„ì¬ëŠ” macOS launchd ê¸°ë°˜ì…ë‹ˆë‹¤. v1.1ì—ì„œ Kubernetes StatefulSet + Init Containerë¡œ í¬íŒ… ì˜ˆì •ì…ë‹ˆë‹¤.

### Q: Claude API ë¹„ìš©ì€?
A: Emergency RecoveryëŠ” ë“œë¬¼ê²Œ ë°œìƒí•©ë‹ˆë‹¤ (ê·¹í•œ ìƒí™©ë§Œ). ì¼ë°˜ì ìœ¼ë¡œ ì›” $5 ë¯¸ë§Œ ì˜ˆìƒ.

### Q: ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ë„ ì ìš© ê°€ëŠ¥í•œê°€ìš”?
A: ë„¤! Watchdog ìŠ¤í¬ë¦½íŠ¸ëŠ” ë²”ìš©ì ì…ë‹ˆë‹¤. Gateway ëŒ€ì‹  ë‹¤ë¥¸ Node.js/Python/Go ì„œë¹„ìŠ¤ì—ë„ ì ìš© ê°€ëŠ¥.

---

## ğŸ™ ê¸°ì—¬ í™˜ì˜

**Issues**: https://github.com/Ramsbaby/openclaw-private/issues
**Discussions**: https://github.com/Ramsbaby/openclaw-private/discussions
**Pull Requests**: ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤!

---

**Tags**: `#AI` `#SelfHealing` `#Claude` `#DevOps` `#SRE` `#Automation` `#OpenSource`

**Written by**: Ramsbaby
**Date**: 2026-02-09
**GitHub**: https://github.com/Ramsbaby
